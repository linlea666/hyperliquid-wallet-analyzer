# 宝塔面板反向代理配置详细说明

## 📋 配置方式说明

有两种配置方式，**推荐使用方式二**（更简单）：

---

## 方式一：使用宝塔面板的「反向代理」功能

### ⚠️ 注意
这种方式会将**整个域名**代理到后端，不适合我们的场景（因为前端和 API 需要共用一个域名）。

**不推荐使用这种方式！**

---

## 方式二：在网站配置文件中直接配置（推荐）⭐

### 步骤

#### 1. 添加网站（如果还没添加）

1. 点击左侧「**网站**」
2. 点击「**添加站点**」
3. 填写信息：
   - **域名**：填写前端绑定的域名（如：`wallet.yourdomain.com` 或服务器 IP）
   - **备注**：`HyperLiquid 钱包分析系统`
   - **根目录**：`/www/wwwroot/gendan/frontend/dist`
   - **PHP版本**：纯静态（不需要 PHP）

4. 点击「**提交**」

---

#### 2. 配置反向代理（在网站配置文件中）

1. 点击网站右侧「**设置**」
2. 点击「**配置文件**」
3. 找到 `location /` 部分，**替换**为以下配置：

```nginx
# 前端静态文件
location / {
    root /www/wwwroot/gendan/frontend/dist;
    try_files $uri $uri/ /index.html;
    index index.html;
}

# API 反向代理（重要！）
location /api {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # 支持 WebSocket（如果需要）
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
}
```

4. 点击「**保存**」
5. 点击「**重载配置**」或「**重启**」

---

## 📝 配置说明

### 域名填写

**域名**：填写前端绑定的域名
- 如果有域名：`wallet.yourdomain.com`
- 如果没有域名：填写服务器 IP（如：`192.168.1.100`）
- 可以填写多个域名，每行一个

### 工作原理

1. **前端访问**：用户访问 `http://域名/` → Nginx 返回前端静态文件
2. **API 请求**：前端请求 `http://域名/api/wallets` → Nginx 转发到 `http://127.0.0.1:8000/api/wallets`

### 配置解释

- `location /`：处理所有前端路由，返回静态文件
- `location /api`：处理所有 `/api` 开头的请求，转发到后端
- `try_files $uri $uri/ /index.html`：支持 Vue Router 的前端路由
- `proxy_pass http://127.0.0.1:8000`：后端服务地址

---

## ✅ 验证配置

### 1. 测试前端

访问：`http://您的域名/`

应该能看到前端界面。

### 2. 测试 API

访问：`http://您的域名/api/health`

应该返回：
```json
{"status": "ok"}
```

### 3. 测试 API 文档

访问：`http://您的域名/api/docs`

应该能看到 FastAPI 的 API 文档页面。

---

## 🐛 常见问题

### Q1: 如果使用宝塔面板的「反向代理」功能，应该怎么填？

**A**: 不推荐使用这个功能，因为：
- 它会将整个域名代理到后端
- 前端静态文件无法访问
- 需要更复杂的配置

**建议**：直接在网站配置文件中配置（方式二）。

---

### Q2: 域名这里填写什么？

**A**: 
- **如果有域名**：填写您的域名（如：`wallet.yourdomain.com`）
- **如果没有域名**：填写服务器 IP（如：`192.168.1.100` 或公网 IP）

**注意**：这个域名是前端和 API 共用的，通过路径区分（`/` 是前端，`/api` 是 API）。

---

### Q3: 前端和 API 可以分开使用不同域名吗？

**A**: 可以，但需要额外配置：
1. 前端域名：`wallet.yourdomain.com` → 指向前端静态文件
2. API 域名：`api.yourdomain.com` → 反向代理到 `http://127.0.0.1:8000`

然后修改前端代码中的 API 基础 URL。

**推荐**：使用同一个域名，通过路径区分（更简单）。

---

### Q4: 配置后前端无法访问 API？

**A**: 检查：
1. 后端是否运行：访问 `http://127.0.0.1:8000/docs`（在服务器上）
2. Nginx 配置是否正确：检查 `location /api` 部分
3. 防火墙是否开放 8000 端口（仅用于本地访问，不需要对外开放）
4. 查看 Nginx 错误日志：网站设置 → 「日志」→ 「错误日志」

---

## 🎯 推荐配置流程

1. ✅ **添加网站**：填写域名，根目录指向前端 `dist` 目录
2. ✅ **修改配置文件**：添加 `location /api` 反向代理配置
3. ✅ **保存并重载**：保存配置，重载 Nginx
4. ✅ **测试访问**：测试前端和 API 是否正常

---

## 📞 需要帮助？

如果遇到问题：
1. 截图 Nginx 配置文件
2. 截图错误日志
3. 告诉我具体的错误信息

我可以帮您解决！🚀


