# HyperLiquid 钱包分析系统 - 需求规划文档

## 一、项目概述

### 1.1 项目定位
一款为交易者、跟单用户设计的聪明钱挖掘系统，通过分析 HyperLiquid 链上钱包数据，帮助用户发现优质交易者并辅助跟单决策。

### 1.2 核心价值
- **智能挖掘**：自动发现潜力钱包（1-6个月新崛起的小资金聪明钱）
- **深度分析**：多维度分析钱包交易行为和收益表现
- **可视化展示**：直观的图表和指标展示
- **跟单参考**：提供详细的交易历史和风险指标

---

## 二、功能需求详细规划

### 2.1 钱包导入功能

#### 2.1.1 单个导入
- 支持输入钱包地址（支持多种格式：0x开头、短地址等）
- 地址格式验证
- 导入时立即触发首次数据抓取和分析
- 导入成功/失败提示

#### 2.1.2 批量导入
- **支持方式**：
  - 上传 CSV/TXT 文件（每行一个地址）
  - 粘贴文本（每行一个地址）
  - 从剪贴板导入
- **性能优化**：
  - 批量导入时采用队列机制，避免并发过高
  - 分批处理（每批100-200个地址）
  - 显示导入进度（已处理/总数）
  - 支持后台导入，不阻塞界面
  - 失败地址记录到日志，可重试
- **去重机制**：自动检测重复地址，跳过已存在的钱包

#### 2.1.3 导入后处理
- 自动验证地址有效性
- 首次数据抓取（历史交易记录）
- 初始分析计算（基础指标）
- 加入监控队列

### 2.2 数据更新策略

#### 2.2.1 更新频率规划
- **实时更新**（用户主动刷新）：
  - 用户点击刷新按钮时立即调用 API
  - 显示"更新中"状态
  
- **定时更新**（后台任务）：
  - **活跃钱包**（最近7天有交易）：每 1 小时更新一次
  - **普通钱包**（最近30天有交易）：每 6 小时更新一次
  - **休眠钱包**（30天以上无交易）：每 24 小时更新一次
  - **新导入钱包**：导入后立即更新，之后按活跃度分类

#### 2.2.2 缓存策略
- **数据缓存**：
  - API 响应缓存 5 分钟（避免频繁请求）
  - 历史交易数据本地存储，增量更新
  - 计算结果缓存，避免重复计算
  
- **更新优先级**：
  - 用户正在查看的钱包 > 推荐钱包 > 其他钱包
  - 支持手动设置钱包更新优先级

#### 2.2.3 增量更新机制
- 只抓取新增的交易记录（基于时间戳）
- 避免重复计算已分析的数据
- 增量更新指标（基于历史数据+新数据）

### 2.3 数据存储设计

#### 2.3.1 存储结构（JSON 文件）
```
data/
├── wallets/
│   ├── {wallet_address}.json          # 单个钱包完整数据
│   └── index.json                      # 钱包索引（地址列表+基础信息）
├── cache/
│   ├── api_cache/                      # API 响应缓存
│   └── calculations/                   # 计算结果缓存
├── config/
│   ├── system.json                     # 系统配置
│   ├── scoring.json                    # 评分权重配置
│   ├── filters.json                    # 筛选条件配置
│   └── notifications.json              # 通知配置
└── logs/
    ├── app.log                         # 应用日志
    ├── api.log                         # API 调用日志
    └── error.log                       # 错误日志
```

#### 2.3.2 钱包数据模型（wallet.json）
```json
{
  "address": "0x...",
  "imported_at": "2024-01-01T00:00:00Z",
  "last_updated": "2024-01-01T12:00:00Z",
  "update_frequency": "active",  // active/normal/dormant
  "metadata": {
    "avatar": "generated_hash",
    "tags": ["短线", "空头偏好"],
    "wallet_age_days": 120,
    "first_trade_time": "2024-01-01T00:00:00Z",  // 第一笔合约开仓时间
    "wallet_created_time": "2024-01-01T00:00:00Z"  // 钱包创建时间（第一笔存款时间）
  },
  "metrics": {
    "total_pnl": 5000,
    "roi": 250,
    "win_rate": 0.65,
    "profit_loss_ratio": 2.5,
    "max_drawdown": 0.25,
    "current_balance": 7000,
    "initial_capital": 2000,  // 初始资金（累计存款 - 累计取款）
    "total_deposits": 5000,  // 累计存款
    "total_withdrawals": 3000,  // 累计取款
    "net_deposits": 2000,  // 净存款（存款 - 取款）
    "margin_ratio": 0.3,
    "closed_trades_count": 150,
    "smart_money_score": 85
  },
  "risk_metrics": {
    "volatility": 0.15,
    "max_drawdown": 0.25,
    "sharpe_ratio": 1.8,
    "liquidation_count": 0
  },
  "behavior": {
    "trading_frequency": "high",  // high/medium/low
    "holding_period": "short",    // short/medium/long
    "long_short_preference": "short",  // long/short/balanced
    "style": "trend",  // trend/scalping/stable
    "coin_preference": ["BTC", "ETH"]
  },
  "trades": [
    {
      "timestamp": "2024-01-01T10:00:00Z",
      "symbol": "BTC",
      "side": "long",
      "size": 1.5,
      "entry_price": 40000,
      "exit_price": 41000,
      "pnl": 1500,
      "holding_time_minutes": 120,
      "fees": 10,
      "trade_count": 1
    }
  ],
  "equity_curve": {
    "24h": [[timestamp, balance], ...],
    "7d": [[timestamp, balance], ...],
    "30d": [[timestamp, balance], ...],
    "all": [[timestamp, balance], ...]
  },
  "current_positions": [
    {
      "symbol": "BTC",
      "side": "long",
      "size": 2.0,
      "entry_price": 42000,
      "mark_price": 42500,
      "unrealized_pnl": 1000,
      "leverage": 10
    }
  ],
  "deposits": [
    {
      "timestamp": "2024-01-01T00:00:00Z",
      "amount": 2000,
      "tx_hash": "0x...",
      "status": "confirmed"
    }
  ],
  "withdrawals": [
    {
      "timestamp": "2024-01-15T00:00:00Z",
      "amount": 1000,
      "tx_hash": "0x...",
      "status": "confirmed"
    }
  ]
}
```

### 2.4 首页功能（Wallet Explorer）

#### 2.4.1 导航栏
- **标签切换**：
  - 全部钱包
  - 潜力钱包推荐（智能筛选）
- **时间筛选**：24H / 7D / 30D / 全部
- **排序选项**：
  - 收益（总盈亏）
  - ROI（收益率）
  - 胜率
  - 风险（最大回撤，升序）
  - 钱包年龄
  - Smart Money Score（默认）
- **搜索框**：支持钱包地址搜索（支持部分匹配）
- **统计信息**：显示当前筛选条件下的钱包数量
- **分页控制**：每页显示数量可配置（默认20/50/100）

#### 2.4.2 筛选条件栏
- **收益指标**：
  - ROI 范围滑块（-100% 到 +1000%）
  - 盈亏比（R值）范围（0 到 10）
  - 胜率范围（0% 到 100%）
- **风险指标**：
  - 最大回撤范围（0% 到 100%）
  - 波动率范围
- **资金规模**：
  - 本金规模范围（$0 到 $10000）
  - 当前余额范围
- **钱包特征**：
  - 钱包年龄（默认：1-6个月，可自定义）
    - 计算方式：基于第一笔合约开仓时间（first_trade_time）
    - 筛选范围：1个月 / 3个月 / 6个月 / 1年 / 全部
  - 交易风格：短线 / 趋势 / 稳健（可多选）
  - 多空偏好：多头 / 空头 / 平衡（可多选）
  - 交易频率：高频 / 中频 / 低频（可多选）
  - 爆仓次数：0次优先 / 允许1次 / 允许多次
  - 初始资金范围（基于存款取款计算）
- **高级筛选**：
  - Smart Money Score 范围（0-100）
  - 币种偏好（BTC/ETH/ALT/MEME）
  - 持仓周期偏好

#### 2.4.3 钱包卡片
每个卡片显示：
- **头部**：
  - 钱包头像（像素风格，基于地址生成）
  - 钱包地址（可复制按钮）
  - 收藏按钮（⭐）
  - 系统标签（最多3个）
- **核心指标**：
  - 总盈亏（带颜色：绿/红）
  - 多单盈亏 / 空单盈亏
  - ROI（百分比）
  - 胜率（百分比）
- **可视化**：
  - 收益曲线小图（最近30天）
- **其他信息**：
  - 当前余额
  - 保证金率
  - 已平仓次数
  - 钱包年龄
- **操作**：
  - "查看详情" 按钮

#### 2.4.4 推荐页（Smart Picks）
- **推荐算法**：
  - 钱包年龄：1-6 个月（可配置）
  - ROI > 200%（可配置）
  - 盈亏比 > 2.0（可配置）
  - 最大回撤 < 40%（可配置）
  - 本金 < $2000（可配置）
  - 胜率 > 55%（可配置）
  - Smart Money Score > 70（可配置）
- **推荐理由**：显示为什么推荐这个钱包（如"高ROI+低回撤"）
- **推荐数量**：默认显示 Top 20，可调整

### 2.5 钱包详情页（Wallet Profile）

#### 2.5.1 顶部信息卡片
- **钱包标识**：
  - 头像（大尺寸）
  - 地址（完整显示，可复制）
  - 收藏按钮
- **标签系统**：
  - 自动生成标签（短线/空头偏好/稳健/趋势/小资金高手等）
  - 用户自定义标签（可选）
- **核心数据**：
  - 总收益（大字体，带颜色）
  - 当前余额
  - 保证金率（带风险提示）
- **Smart Money Score**：
  - 大号显示（0-100）
  - 进度条可视化
  - 评分详情（点击展开各维度得分）
- **操作按钮**：
  - 刷新数据
  - 分享钱包（生成分享链接）
  - 导出数据（CSV/JSON）
  - 删除钱包（需确认）

#### 2.5.2 收益曲线图
- **时间区间切换**：24小时 / 7天 / 30天 / 1个月 / 全部
- **曲线类型切换**：
  - 总收益曲线（默认）
  - 多单收益曲线
  - 空单收益曲线
  - 对比显示（可叠加）
- **交互功能**：
  - 鼠标悬浮显示数据点详情
  - 缩放功能
  - 时间范围选择器
- **数据标注**：
  - 关键事件标记（大额盈利/亏损、爆仓等）

#### 2.5.3 钱包指标区（Key Metrics）
**收益表现**：
- 累计盈亏（总/多/空）
- ROI（总/多/空）
- 平均盈利金额
- 平均亏损金额
- 最大单笔盈利
- 最大单笔亏损

**风险指标**：
- 最大回撤（MDD）
- 收益波动率
- Sharpe 比率
- Sortino 比率
- 风险收益比

**行为模式**：
- 交易频率（交易次数/天）
- 平均持仓周期
- 多空偏好（多头占比/空头占比）
- 最常交易币种（Top 5）
- 交易时段分布（热力图）

**稳定性**：
- 胜率（总/多/空）
- 连续盈利天数
- 连续亏损天数
- 盈亏交替频率

**资金规模**：
- Peak Capital（峰值资金）
- 初始资金（基于存款取款计算）
- 累计存款 / 累计取款
- 净存款（存款 - 取款）
- 本金规模变化曲线（包含存款取款）
- 平均杠杆率
- 当前杠杆率

#### 2.5.4 交易历史表格
- **表格列**：
  - 时间（可排序）
  - 币种（可筛选）
  - 方向（多/空，带颜色）
  - 数量
  - 成交价（开仓/平仓）
  - 盈亏（带颜色）
  - 持仓时间
  - 手续费
  - 成交次数
  - 操作（查看详情）
- **功能**：
  - 分页加载（每页50条）
  - 无限滚动（可选）
  - 排序（按时间/盈亏/持仓时间等）
  - 筛选（按币种/方向/盈亏等）
  - 搜索（币种名称）
  - 导出当前筛选结果（CSV）

#### 2.5.5 当前持仓信息
- **持仓列表**：
  - 币种
  - 方向（多/空）
  - 持仓数量
  - 开仓价格
  - 当前价格
  - 未实现盈亏
  - 杠杆倍数
  - 持仓时间
- **持仓统计**：
  - 总持仓价值
  - 总未实现盈亏
  - 多空比例
  - 风险提示（高杠杆/接近爆仓等）

#### 2.5.7 资金流水（存款取款记录）
- **存款记录表格**：
  - 时间（可排序）
  - 金额
  - 交易哈希
  - 状态（确认中/已确认）
- **取款记录表格**：
  - 时间（可排序）
  - 金额
  - 交易哈希
  - 状态（确认中/已确认）
- **统计信息**：
  - 累计存款总额
  - 累计取款总额
  - 净存款（存款 - 取款）
  - 初始资金（用于 ROI 计算）
- **资金流向图**：
  - 存款取款时间线
  - 余额变化曲线（包含存款取款影响）

#### 2.5.6 钱包画像（AI 风格标签）
- **自动生成标签**：
  - 交易风格：趋势交易者 / 高频短线 / 稳健型 / 长期持有
  - 波动偏好：BTC偏好 / ALT偏好 / MEME偏好 / 均衡
  - 资金特征：小资金高效率 / 大资金稳健 / 中等规模
  - 风险等级：低风险 / 中风险 / 高风险
  - 特殊标记：爆仓次数（如有）
- **标签说明**：鼠标悬浮显示标签生成依据

### 2.6 Smart Money Score 评分系统

#### 2.6.1 评分维度
- **ROI（35%）**：
  - 计算公式：根据 ROI 值映射到 0-35 分
  - ROI > 500%: 35分
  - ROI 200-500%: 25-35分
  - ROI 100-200%: 15-25分
  - ROI 50-100%: 10-15分
  - ROI < 50%: 0-10分
  
- **盈亏比 R（20%）**：
  - R > 3.0: 20分
  - R 2.0-3.0: 15-20分
  - R 1.5-2.0: 10-15分
  - R 1.0-1.5: 5-10分
  - R < 1.0: 0-5分
  
- **最大回撤（20%）**：
  - MDD < 20%: 20分
  - MDD 20-30%: 15-20分
  - MDD 30-40%: 10-15分
  - MDD 40-50%: 5-10分
  - MDD > 50%: 0-5分
  
- **胜率 + 稳定性（15%）**：
  - 胜率 > 70%: 10分
  - 胜率 60-70%: 7-10分
  - 胜率 50-60%: 4-7分
  - 胜率 < 50%: 0-4分
  - 稳定性加分（连续盈利天数）：0-5分
  
- **资金规模（5%）**：
  - 本金 < $2000 且 ROI 高: 5分（小资金高效率）
  - 本金 $2000-5000: 3分
  - 本金 > $5000: 1分
  
- **风格（5%）**：
  - 趋势交易: 3分
  - 稳健型: 5分
  - 短线高频: 2分

#### 2.6.2 评分配置化
- 所有权重和阈值都可在配置文件中调整
- 支持多套评分方案（可切换）

### 2.7 其他功能

#### 2.7.1 钱包收藏
- 用户可收藏钱包
- 收藏列表单独展示
- 收藏数据本地存储（localStorage）

#### 2.7.2 数据导出
- 支持导出钱包列表（CSV）
- 支持导出单个钱包详情（JSON/CSV）
- 支持导出交易历史（CSV）

#### 2.7.3 钱包对比
- 支持选择多个钱包进行对比
- 对比维度：收益、风险、交易风格等

#### 2.7.4 可视化看板（Dashboard）

**页面位置**：新增独立页面，作为首页或独立入口

**核心功能**：

##### 2.7.4.1 总体统计卡片
- **钱包总数**：已导入的钱包数量
- **总资产规模**：所有钱包当前余额总和
- **总盈亏**：所有钱包累计盈亏总和
- **平均 ROI**：所有钱包的平均 ROI
- **平均胜率**：所有钱包的平均胜率
- **活跃钱包数**：最近24小时有交易的钱包数

##### 2.7.4.2 多空比统计
- **整体多空比**：
  - 多头持仓总价值 vs 空头持仓总价值
  - 可视化饼图/柱状图
  - 多空比例数值显示
- **按币种多空比**：
  - BTC/ETH/其他币种的多空分布
  - 横向对比图表
- **多空盈亏对比**：
  - 多头总盈亏 vs 空头总盈亏
  - 趋势对比图

##### 2.7.4.3 合约方向统计
- **持仓方向分布**：
  - 各币种的持仓方向（多/空）
  - 热力图展示
- **交易方向统计**：
  - 历史交易中多单 vs 空单数量
  - 多单 vs 空单盈亏对比
- **方向偏好分析**：
  - 各钱包的多空偏好标签统计
  - 多头偏好钱包数 / 空头偏好钱包数 / 平衡型钱包数

##### 2.7.4.4 资金数据统计
- **资金规模分布**：
  - 小资金（< $1000）钱包数
  - 中等资金（$1000-$5000）钱包数
  - 大资金（> $5000）钱包数
  - 饼图/柱状图展示
- **资金流向统计**：
  - 最近24小时/7天/30天总存款
  - 最近24小时/7天/30天总取款
  - 净资金流入/流出趋势图
- **初始资金分布**：
  - 各初始资金区间的钱包数量
  - 初始资金与 ROI 的关系散点图

##### 2.7.4.5 爆仓信息统计
- **爆仓统计卡片**：
  - 总爆仓次数
  - 爆仓钱包数
  - 爆仓率（爆仓钱包数/总钱包数）
- **爆仓时间线**：
  - 最近爆仓记录列表
  - 显示钱包地址、币种、爆仓时间、损失金额
- **爆仓分析**：
  - 爆仓原因分析（高杠杆/方向错误等）
  - 爆仓币种分布
  - 爆仓时间分布（热力图）

##### 2.7.4.6 钱包异动监控
- **大额交易异动**：
  - 最近24小时大额交易列表
  - 筛选条件：交易金额 > 阈值（可配置，默认 $10000）
  - 显示：钱包地址、币种、方向、金额、时间
  - 支持按金额/时间排序
- **大额存取款异动**：
  - 最近24小时大额存款列表（金额 > 阈值）
  - 最近24小时大额取款列表（金额 > 阈值）
  - 显示：钱包地址、金额、时间、交易哈希
  - 异动趋势图（时间线）
- **异常行为检测**：
  - 突然大额盈利/亏损（超过阈值）
  - 交易频率异常（突然增加/减少）
  - 持仓方向突然改变
  - 杠杆率异常变化

##### 2.7.4.7 排行榜
- **收益排行榜**：
  - Top 10 盈利钱包
  - Top 10 ROI 钱包
  - Top 10 Smart Money Score 钱包
- **活跃度排行榜**：
  - Top 10 交易次数最多的钱包
  - Top 10 交易频率最高的钱包

##### 2.7.4.8 趋势图表
- **整体收益趋势**：
  - 所有钱包总收益曲线（24H/7D/30D/全部）
- **多空比趋势**：
  - 多空比例随时间变化曲线
- **资金流入流出趋势**：
  - 存款取款净流量趋势图

##### 2.7.4.9 实时更新
- 看板数据自动刷新（可配置刷新间隔，默认30秒）
- 手动刷新按钮
- 数据更新时间显示

#### 2.7.5 通知提醒系统

##### 2.7.5.1 通知类型
- **收益提醒**：
  - 钱包收益达到设定阈值（可配置）
  - 钱包 ROI 达到设定阈值
  - 钱包单笔交易盈利超过阈值
- **风险提醒**：
  - 钱包爆仓提醒
  - 钱包最大回撤超过阈值
  - 钱包余额低于阈值（接近爆仓）
  - 钱包杠杆率过高
- **异动提醒**：
  - 大额交易提醒（交易金额 > 阈值）
  - 大额存款提醒（存款金额 > 阈值）
  - 大额取款提醒（取款金额 > 阈值）
  - 交易频率异常提醒
  - 持仓方向突然改变提醒
- **系统提醒**：
  - 钱包数据更新失败提醒
  - API 调用异常提醒
  - 系统错误提醒

##### 2.7.5.2 通知方式

**浏览器推送通知**：
- 使用 Web Notification API
- 需要用户授权
- 支持桌面通知（即使浏览器关闭也能收到）
- 通知内容：
  - 标题：通知类型（如"大额交易提醒"）
  - 内容：简要信息（如"钱包 0x1234... 发生大额交易 $50000"）
  - 图标：钱包头像或系统图标
  - 点击跳转：跳转到对应钱包详情页
- 通知设置：
  - 开启/关闭浏览器通知
  - 设置通知声音
  - 设置通知持续时间

**邮件通知**：
- 使用 SMTP 发送邮件
- 支持配置邮件服务器（Gmail/QQ邮箱/自定义SMTP）
- 邮件内容：
  - 主题：通知类型和钱包地址
  - 正文：详细信息（HTML格式）
    - 钱包地址和头像
    - 事件详情
    - 相关数据（金额、时间等）
    - 跳转链接
- 邮件设置：
  - 开启/关闭邮件通知
  - 配置 SMTP 服务器
  - 设置发件人邮箱和密码
  - 设置收件人邮箱（可多个）
  - 设置邮件发送频率（立即/每小时汇总/每天汇总）

##### 2.7.5.3 通知配置

**全局通知设置**（config/notifications.json）：
```json
{
  "enabled": true,
  "browser": {
    "enabled": true,
    "sound": true,
    "duration": 5000
  },
  "email": {
    "enabled": false,
    "smtp": {
      "host": "smtp.gmail.com",
      "port": 587,
      "username": "",
      "password": "",
      "from_email": "",
      "to_emails": []
    },
    "frequency": "immediate"  // immediate/hourly/daily
  },
  "thresholds": {
    "large_trade": 10000,
    "large_deposit": 5000,
    "large_withdrawal": 5000,
    "profit_threshold": 5000,
    "roi_threshold": 200,
    "drawdown_threshold": 50
  }
}
```

**钱包级别通知设置**：
- 每个钱包可单独设置通知规则
- 可选择关注的钱包（只接收关注钱包的通知）
- 可设置钱包特定的阈值

##### 2.7.5.4 通知历史
- 通知记录存储（data/notifications.json）
- 通知历史页面：
  - 显示所有历史通知
  - 支持筛选（按类型/时间/钱包）
  - 支持标记已读/未读
  - 支持删除通知
- 通知统计：
  - 今日通知数
  - 未读通知数
  - 各类型通知数量

##### 2.7.5.5 通知实现
- **后端**：
  - 定时检查钱包数据变化
  - 触发通知条件时生成通知
  - 发送浏览器推送（通过 WebSocket）
  - 发送邮件通知
  - 记录通知历史
- **前端**：
  - 请求浏览器通知权限
  - 接收 WebSocket 通知消息
  - 显示浏览器通知
  - 通知中心（显示历史通知）

---

## 三、技术栈选择

### 3.1 后端技术栈

**推荐方案：Python + FastAPI**

**理由**：
- ✅ 简单易学，代码可读性强
- ✅ 丰富的数据处理库（pandas, numpy）
- ✅ FastAPI 性能好，自动生成 API 文档
- ✅ 异步支持，适合批量处理
- ✅ 部署简单（Docker/直接运行）
- ✅ 社区支持好，问题容易解决

**技术选型**：
- **Web 框架**：FastAPI
- **数据处理**：pandas, numpy
- **HTTP 客户端**：httpx（异步）
- **任务队列**：APScheduler（定时任务）
- **数据存储**：JSON 文件（简单）+ 可选 SQLite（后期扩展）
- **日志**：Python logging + loguru（更友好）

### 3.2 前端技术栈

**推荐方案：Vue 3 + Vite + Element Plus**

**理由**：
- ✅ Vue 3 学习曲线平缓
- ✅ Vite 开发体验好，构建快
- ✅ Element Plus 组件丰富，UI 美观
- ✅ 图表库选择多（ECharts/ApexCharts）
- ✅ 打包后单文件部署，简单

**技术选型**：
- **框架**：Vue 3 + Composition API
- **构建工具**：Vite
- **UI 组件库**：Element Plus
- **图表库**：ECharts（功能强大，文档完善）
- **状态管理**：Pinia（轻量）
- **路由**：Vue Router
- **HTTP 客户端**：axios

### 3.3 部署方案

**推荐：Docker Compose**

**理由**：
- ✅ 一键部署，环境隔离
- ✅ 跨平台（Windows/Mac/Linux）
- ✅ 配置简单，小白友好
- ✅ 易于维护和更新

**备选方案**：
- 直接运行（Python + Node.js）
- 云服务部署（Vercel/Netlify 前端 + Railway/Render 后端）

---

## 四、系统架构设计

### 4.1 整体架构

```
┌─────────────────────────────────────────┐
│          前端 (Vue 3 + Vite)            │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ Dashboard    │  │ Wallet List  │    │
│  └──────────────┘  └──────────────┘    │
│  ┌──────────────┐  ┌──────────────┐    │
│  │Wallet Detail │  │ Notifications│    │
│  └──────────────┘  └──────────────┘    │
└─────────────────────────────────────────┘
                  │ HTTP API + WebSocket
┌─────────────────────────────────────────┐
│       后端 API (FastAPI)                │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ REST API     │  │ WebSocket    │    │
│  └──────────────┘  └──────────────┘    │
│  ┌──────────────┐  ┌──────────────┐    │
│  │Notification  │  │ Email Service│    │
│  │   Service    │  │              │    │
│  └──────────────┘  └──────────────┘    │
└─────────────────────────────────────────┘
                  │
┌─────────────────────────────────────────┐
│        业务逻辑层                        │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ 数据分析引擎 │  │ 评分计算引擎 │    │
│  └──────────────┘  └──────────────┘    │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ 数据更新服务 │  │ 推荐算法服务 │    │
│  └──────────────┘  └──────────────┘    │
└─────────────────────────────────────────┘
                  │
┌─────────────────────────────────────────┐
│        数据访问层                        │
│  ┌──────────────┐  ┌──────────────┐    │
│  │ JSON 存储    │  │ API 客户端   │    │
│  └──────────────┘  └──────────────┘    │
└─────────────────────────────────────────┘
                  │
┌─────────────────────────────────────────┐
│      HyperLiquid API                    │
└─────────────────────────────────────────┘
```

### 4.2 目录结构

```
gendan/
├── backend/                    # 后端代码
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py            # FastAPI 入口
│   │   ├── api/               # API 路由
│   │   │   ├── __init__.py
│   │   │   ├── wallets.py     # 钱包相关 API
│   │   │   ├── analysis.py    # 分析相关 API
│   │   │   └── config.py      # 配置相关 API
│   │   ├── core/              # 核心业务逻辑
│   │   │   ├── __init__.py
│   │   │   ├── analyzer.py    # 数据分析引擎
│   │   │   ├── scorer.py      # 评分计算
│   │   │   ├── recommender.py # 推荐算法
│   │   │   └── updater.py     # 数据更新服务
│   │   ├── services/          # 服务层
│   │   │   ├── __init__.py
│   │   │   ├── hyperliquid.py # HyperLiquid API 客户端
│   │   │   ├── storage.py     # 数据存储服务
│   │   │   └── cache.py       # 缓存服务
│   │   ├── models/            # 数据模型
│   │   │   ├── __init__.py
│   │   │   ├── wallet.py      # 钱包模型
│   │   │   └── trade.py       # 交易模型
│   │   ├── utils/             # 工具函数
│   │   │   ├── __init__.py
│   │   │   ├── logger.py      # 日志工具
│   │   │   └── validators.py  # 验证工具
│   │   └── config.py          # 配置管理
│   ├── data/                  # 数据目录
│   │   ├── wallets/           # 钱包数据
│   │   ├── cache/             # 缓存数据
│   │   ├── config/            # 配置文件
│   │   └── notifications.json # 通知历史
│   ├── logs/                  # 日志目录
│   ├── requirements.txt       # Python 依赖
│   ├── Dockerfile             # Docker 镜像
│   └── docker-compose.yml     # Docker Compose 配置
│
├── frontend/                  # 前端代码
│   ├── src/
│   │   ├── assets/           # 静态资源
│   │   ├── components/       # 组件
│   │   │   ├── WalletCard.vue
│   │   │   ├── WalletDetail.vue
│   │   │   ├── Dashboard.vue
│   │   │   ├── Chart.vue
│   │   │   └── ...
│   │   ├── views/            # 页面
│   │   │   ├── Dashboard.vue    # 看板页面
│   │   │   ├── WalletList.vue
│   │   │   ├── WalletDetail.vue
│   │   │   └── Notifications.vue # 通知中心
│   │   ├── stores/           # 状态管理
│   │   ├── api/              # API 调用
│   │   ├── utils/            # 工具函数
│   │   ├── App.vue
│   │   └── main.js
│   ├── public/
│   ├── package.json
│   ├── vite.config.js
│   └── Dockerfile
│
├── docs/                      # 文档
│   ├── API.md                # API 文档
│   ├── DEPLOY.md             # 部署文档
│   └── USER_GUIDE.md         # 用户指南
│
├── scripts/                   # 脚本
│   ├── init_data.py          # 初始化数据
│   └── backup.sh             # 备份脚本
│
├── docker-compose.yml         # 整体 Docker Compose
├── .gitignore
└── README.md
```

---

## 五、性能优化方案

### 5.1 批量导入优化

#### 5.1.1 队列机制
- 使用任务队列（APScheduler + 内存队列）
- 批量导入时，将地址加入队列
- 后台异步处理，不阻塞用户操作
- 显示处理进度和状态

#### 5.1.2 分批处理
- 每批处理 100-200 个地址
- 批次间延迟 1-2 秒（避免 API 限流）
- 失败重试机制（最多3次）

#### 5.1.3 并发控制
- 限制同时进行的 API 请求数量（最多10个并发）
- 使用信号量控制并发
- API 请求失败时自动退避重试

### 5.2 数据查询优化

#### 5.2.1 索引机制
- 维护钱包索引文件（index.json）
- 包含常用查询字段（地址、ROI、胜率等）
- 定期更新索引，避免全量扫描

#### 5.2.2 分页加载
- 前端分页请求
- 后端只返回当前页数据
- 支持排序和筛选下推

#### 5.2.3 缓存策略
- API 响应缓存（5分钟）
- 计算结果缓存（指标、评分等）
- 列表数据缓存（1分钟）

### 5.3 前端性能优化

#### 5.3.1 虚拟滚动
- 钱包列表使用虚拟滚动（大量数据时）
- 只渲染可见区域

#### 5.3.2 懒加载
- 图表按需加载
- 详情页数据按需加载
- 图片懒加载

#### 5.3.3 防抖节流
- 搜索输入防抖（300ms）
- 滚动事件节流
- 筛选条件变化防抖

---

## 六、配置系统设计

### 6.1 配置文件结构

#### 6.1.1 系统配置（config/system.json）
```json
{
  "api": {
    "base_url": "https://api.hyperliquid.xyz",
    "timeout": 30,
    "retry_times": 3,
    "retry_delay": 1
  },
  "update": {
    "active_interval": 3600,
    "normal_interval": 21600,
    "dormant_interval": 86400,
    "batch_size": 100,
    "concurrent_limit": 10
  },
  "cache": {
    "api_cache_ttl": 300,
    "calculation_cache_ttl": 3600
  },
  "pagination": {
    "default_page_size": 20,
    "max_page_size": 100
  }
}
```

#### 6.1.2 评分配置（config/scoring.json）
```json
{
  "weights": {
    "roi": 0.35,
    "profit_loss_ratio": 0.20,
    "max_drawdown": 0.20,
    "win_rate_stability": 0.15,
    "capital_size": 0.05,
    "style": 0.05
  },
  "thresholds": {
    "roi": {
      "excellent": 500,
      "good": 200,
      "average": 100,
      "poor": 50
    },
    "profit_loss_ratio": {
      "excellent": 3.0,
      "good": 2.0,
      "average": 1.5,
      "poor": 1.0
    },
    "max_drawdown": {
      "excellent": 20,
      "good": 30,
      "average": 40,
      "poor": 50
    },
    "win_rate": {
      "excellent": 70,
      "good": 60,
      "average": 50
    }
  }
}
```

#### 6.1.3 推荐配置（config/recommendation.json）
```json
{
  "filters": {
    "wallet_age_min_days": 30,
    "wallet_age_max_days": 180,
    "min_roi": 200,
    "min_profit_loss_ratio": 2.0,
    "max_drawdown": 40,
    "max_capital": 2000,
    "min_win_rate": 55,
    "min_smart_money_score": 70
  },
  "top_n": 20
}
```

#### 6.1.4 筛选配置（config/filters.json）
```json
{
  "default_filters": {
    "wallet_age": {
      "min": 30,
      "max": 180
    }
  },
  "filter_options": {
    "roi_range": [-100, 1000],
    "profit_loss_ratio_range": [0, 10],
    "win_rate_range": [0, 100],
    "max_drawdown_range": [0, 100],
    "capital_range": [0, 10000]
  }
}
```

### 6.2 配置管理

#### 6.2.1 配置加载
- 启动时加载所有配置文件
- 配置文件变更时热重载（可选）
- 配置验证（格式、范围检查）

#### 6.2.2 配置 API
- 提供 API 接口查看配置
- 提供 API 接口更新配置（需验证）
- 配置变更记录到日志

---

## 七、日志系统设计

### 7.1 日志级别
- **DEBUG**：详细调试信息（开发环境）
- **INFO**：一般信息（操作记录）
- **WARNING**：警告信息（可恢复的错误）
- **ERROR**：错误信息（需要关注）
- **CRITICAL**：严重错误（系统无法继续）

### 7.2 日志分类

#### 7.2.1 应用日志（app.log）
- 钱包导入/删除
- 数据更新
- 用户操作

#### 7.2.2 API 日志（api.log）
- API 请求记录
- API 响应记录
- API 错误记录

#### 7.2.3 错误日志（error.log）
- 异常堆栈
- 错误详情
- 错误上下文

#### 7.2.4 性能日志（performance.log）
- 慢查询记录
- 批量处理耗时
- API 响应时间

### 7.3 日志格式

```
[2024-01-01 12:00:00] [INFO] [wallet_import] Imported wallet: 0x1234...
[2024-01-01 12:00:01] [INFO] [api_call] GET /api/wallets - 200 OK - 150ms
[2024-01-01 12:00:02] [ERROR] [api_call] GET /api/wallet/0x1234 - 500 Error - Connection timeout
[2024-01-01 12:00:03] [WARNING] [data_update] Wallet 0x1234 update failed, will retry
```

### 7.4 日志轮转
- 按大小轮转（10MB）
- 按时间轮转（每天）
- 保留最近 30 天日志
- 自动清理旧日志

---

## 八、API 设计

### 8.1 钱包相关 API

#### 8.1.1 获取钱包列表
```
GET /api/wallets
Query Parameters:
  - page: int (default: 1)
  - page_size: int (default: 20)
  - sort_by: str (roi/win_rate/risk/age/score)
  - order: str (asc/desc)
  - filters: JSON (筛选条件)
  - search: str (地址搜索)
  - tag: str (all/recommended)

Response:
{
  "total": 100,
  "page": 1,
  "page_size": 20,
  "wallets": [...]
}
```

#### 8.1.2 获取钱包详情
```
GET /api/wallets/{address}

Response:
{
  "address": "0x...",
  "metrics": {...},
  "trades": [...],
  "equity_curve": {...},
  "current_positions": [...]
}
```

#### 8.1.3 导入钱包
```
POST /api/wallets/import
Body:
{
  "addresses": ["0x...", "0x..."]  // 单个或批量
}

Response:
{
  "success": ["0x..."],
  "failed": ["0x..."],
  "duplicated": ["0x..."]
}
```

#### 8.1.4 删除钱包
```
DELETE /api/wallets/{address}

Response:
{
  "success": true
}
```

#### 8.1.5 刷新钱包数据
```
POST /api/wallets/{address}/refresh

Response:
{
  "success": true,
  "updated_at": "2024-01-01T12:00:00Z"
}
```

### 8.2 分析相关 API

#### 8.2.1 获取推荐钱包
```
GET /api/recommendations

Response:
{
  "wallets": [...],
  "reasons": {...}  // 推荐理由
}
```

#### 8.2.2 钱包对比
```
POST /api/wallets/compare
Body:
{
  "addresses": ["0x...", "0x..."]
}

Response:
{
  "comparison": {...}
}
```

### 8.3 配置相关 API

#### 8.3.1 获取配置
```
GET /api/config/{config_name}

Response:
{
  "config": {...}
}
```

#### 8.3.2 更新配置
```
PUT /api/config/{config_name}
Body:
{
  "config": {...}
}

Response:
{
  "success": true
}
```

---

## 九、部署方案

### 9.1 Docker 部署（推荐）

#### 9.1.1 Docker Compose 配置
```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "8000:8000"
    volumes:
      - ./data:/app/data
      - ./logs:/app/logs
    environment:
      - ENV=production
    restart: unless-stopped

  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped
```

#### 9.1.2 部署步骤
1. 克隆代码
2. 配置环境变量（如需要）
3. 运行 `docker-compose up -d`
4. 访问 http://localhost

### 9.2 直接部署

#### 9.2.1 后端部署
```bash
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

#### 9.2.2 前端部署
```bash
cd frontend
npm install
npm run build
# 将 dist 目录部署到 Nginx 或其他 Web 服务器
```

### 9.3 一键部署脚本
提供 `deploy.sh` 脚本，自动化部署流程。

---

## 十、数据安全与备份

### 10.1 数据备份
- 定期备份 data 目录（每天）
- 备份到指定目录或云存储
- 保留最近 7 天备份

### 10.2 数据恢复
- 提供恢复脚本
- 支持选择性恢复（单个钱包）

### 10.3 数据安全
- 敏感配置加密存储（可选）
- API 密钥安全管理
- 访问日志记录

---

## 十一、扩展功能（未来）

### 11.1 用户系统
- 用户注册/登录
- 个人收藏夹
- 自定义标签
- 个人设置

### 11.2 通知系统
- 邮件通知
- 微信/Telegram 通知
- 浏览器推送

### 11.3 数据可视化增强
- 更多图表类型
- 交互式分析
- 数据导出更多格式

### 11.4 多链支持
- 支持其他链（如 Solana）
- 统一分析界面

---

## 十二、开发计划

### 12.1 第一阶段（MVP）
- [ ] 后端基础框架
- [ ] HyperLiquid API 集成
- [ ] 钱包导入功能
- [ ] 基础数据分析
- [ ] 前端列表页
- [ ] 前端详情页
- [ ] 基础配置系统

### 12.2 第二阶段（完善）
- [ ] 批量导入优化
- [ ] 定时更新任务
- [ ] 推荐算法
- [ ] 完整评分系统
- [ ] 图表可视化
- [ ] 日志系统

### 12.3 第三阶段（优化）
- [ ] 性能优化
- [ ] UI/UX 优化
- [ ] 错误处理完善
- [ ] 文档完善
- [ ] 部署脚本

---

## 十三、注意事项

### 13.1 API 限制
- 注意 HyperLiquid API 的调用频率限制
- 实现请求限流和退避重试
- 监控 API 调用量

### 13.2 数据准确性
- 定期验证数据准确性
- 处理 API 返回异常情况
- 数据不一致时的处理策略

### 13.3 用户体验
- 加载状态提示
- 错误友好提示
- 操作确认（删除等危险操作）

### 13.4 维护性
- 代码注释完善
- 文档及时更新
- 版本管理规范

---

## 十四、总结

本系统采用 **Python + FastAPI** 后端 + **Vue 3** 前端的架构，使用 **JSON 文件存储**，通过 **Docker** 一键部署，适合小白用户使用。

**核心优势**：
1. ✅ 技术栈简单，易于学习和维护
2. ✅ 配置化设计，灵活可调
3. ✅ 完善的日志系统，问题易排查
4. ✅ 性能优化，支持批量导入
5. ✅ 部署简单，Docker 一键启动

**下一步**：确认需求后开始编码实现。

