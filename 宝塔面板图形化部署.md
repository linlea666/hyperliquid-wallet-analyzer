# 宝塔面板图形化部署指南（推荐）

## 🎯 使用宝塔面板图形界面部署，无需手动运行脚本

---

## 📦 第一步：上传项目文件

1. **登录宝塔面板**
2. **进入「文件」管理**
3. **进入 `/www/wwwroot/` 目录**
4. **上传项目压缩包**（或直接上传解压后的文件夹）
5. **解压文件**（如果上传的是压缩包）
6. **确保项目目录结构正确**：
   ```
   /www/wwwroot/gendan/
   ├── backend/
   │   ├── app/
   │   ├── requirements.txt
   │   └── ...
   └── frontend/
       ├── src/
       ├── package.json
       └── ...
   ```

---

## 🐍 第二步：添加 Python 项目（后端）

### 2.1 创建 Python 项目

1. **进入「软件商店」→「Python项目管理器」**
   - 如果没有安装，先安装「Python项目管理器」

2. **点击「添加项目」**

3. **填写项目信息**：

   | 字段 | 值 | 说明 |
   |------|-----|------|
   | **项目名称** | `hyperliquid-backend` | 自定义名称 |
   | **Python环境** | 选择 Python 3.10+ | 如 `3.11.13` |
   | **启动方式** | `命令行启动` | ✅ 选择这个 |
   | **项目路径** | `/www/wwwroot/gendan/backend` | 后端目录 |
   | **启动命令** | `uvicorn app.main:app --host 0.0.0.0 --port 8000` | FastAPI 启动命令 |
   | **启动用户** | `www` | 默认即可 |
   | **安装依赖包** | `/www/wwwroot/gendan/backend/requirements.txt` | 依赖文件路径 |

4. **点击「更多设置」展开**：

   | 字段 | 值 | 说明 |
   |------|-----|------|
   | **执行命令** | `uvicorn app.main:app --host 0.0.0.0 --port 8000` | 启动命令 |
   | **通讯协议** | `asgi` | ✅ FastAPI 使用 ASGI |
   | **端口** | `8000` | 后端端口 |
   | **项目初始化命令** | `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt` | 安装依赖（使用国内镜像） |

5. **点击「确定」创建项目**

6. **安装依赖**：
   - 项目创建后，点击项目右侧的「模块」
   - 点击「批量安装」
   - 粘贴 `requirements.txt` 的内容，或点击「从文件安装」
   - 选择 `/www/wwwroot/gendan/backend/requirements.txt`

7. **启动项目**：
   - 点击项目右侧的「启动」按钮
   - 状态变为「运行中 ▶」表示启动成功

---

## 📦 第三步：添加 Node 项目（前端 - PM2）

### 3.1 创建 Node 项目

1. **进入「软件商店」→「Node版本管理器」**
   - 如果没有安装，先安装「Node版本管理器」
   - 确保安装了 Node.js 18+

2. **进入「网站」→「Node项目」**

3. **点击「添加项目」**

4. **选择「PM2项目」标签页**（推荐）

5. **填写项目信息**：

   | 字段 | 值 | 说明 |
   |------|-----|------|
   | **项目名称** | `hyperliquid-frontend` | 自定义名称 |
   | **Node版本** | `v20.11.1` 或更高 | 选择已安装的版本 |
   | **启动文件** | `/www/wwwroot/gendan/frontend/vite.config.js` | 或使用 `npm run dev` |
   | **运行目录** | `/www/wwwroot/gendan/frontend` | 前端目录 |
   | **负载实例数量** | `1` | 单实例即可 |
   | **内存上限** | `512` MB | 根据服务器内存调整 |
   | **包管理器** | `npm` | 或 `pnpm` |

6. **点击「确定」创建项目**

7. **安装依赖并构建**：
   - 项目创建后，点击「终端」
   - 运行以下命令：
   ```bash
   cd /www/wwwroot/gendan/frontend
   npm config set registry https://registry.npmmirror.com
   npm install
   npm run build
   ```

8. **启动项目**：
   - 点击项目右侧的「启动」按钮

---

## 🌐 第四步：配置网站（前端访问）

### 4.1 创建网站

1. **进入「网站」→「添加站点」**

2. **填写信息**：
   - **域名**: 您的域名（如 `wallet.yourdomain.com`）或 IP
   - **根目录**: `/www/wwwroot/gendan/frontend/dist`
   - **PHP版本**: 纯静态

3. **点击「提交」**

### 4.2 配置反向代理

1. **点击网站「设置」→「反向代理」**

2. **点击「添加反向代理」**

3. **填写配置**：
   - **代理名称**: `api`
   - **目标URL**: `http://127.0.0.1:8000`
   - **发送域名**: `$host`
   - **缓存**: 关闭

4. **高级设置**：
   - **代理目录**: `/api`
   - **内容替换**: 不填

5. **点击「提交」**

### 4.3 配置前端路由（重要）

1. **点击网站「设置」→「配置文件」**

2. **在 `location /` 块中添加**：
   ```nginx
   location / {
       try_files $uri $uri/ /index.html;
   }
   ```

3. **保存并重启 Nginx**

---

## ✅ 第五步：验证部署

### 检查服务状态

1. **Python 项目**：
   - 进入「Python项目管理器」
   - 查看 `hyperliquid-backend` 状态应为「运行中 ▶」

2. **Node 项目**（如果使用 PM2）：
   - 进入「Node项目」
   - 查看 `hyperliquid-frontend` 状态应为「运行中 ▶」

### 访问测试

- **前端界面**: `http://your-domain.com`
- **后端 API**: `http://your-domain.com/api/health`
- **API 文档**: `http://your-domain.com/api/docs`

---

## 🔧 配置说明

### Python 项目配置要点

1. **启动方式**: 选择「命令行启动」
2. **通讯协议**: 选择 `asgi`（FastAPI 需要）
3. **启动命令**: `uvicorn app.main:app --host 0.0.0.0 --port 8000`
4. **项目路径**: `/www/wwwroot/gendan/backend`
5. **端口**: `8000`

### Node 项目配置要点（如果使用 PM2）

1. **项目类型**: 选择「PM2项目」
2. **运行目录**: `/www/wwwroot/gendan/frontend`
3. **启动文件**: 可以创建一个启动脚本，或直接使用 `npm run dev`

### 或者：前端使用静态文件（推荐）

**更简单的方式**：前端构建后直接使用静态文件，不需要 Node 项目：

1. **构建前端**（在终端运行）：
   ```bash
   cd /www/wwwroot/gendan/frontend
   npm install
   npm run build
   ```

2. **配置网站根目录为** `/www/wwwroot/gendan/frontend/dist`

3. **配置反向代理**（同上）

---

## 📝 推荐配置方案

### 方案一：Python + 静态前端（最简单）⭐

- **后端**: Python 项目管理器（PM2）
- **前端**: 静态文件（Nginx 直接服务）
- **优点**: 简单、稳定、性能好

### 方案二：Python + Node PM2

- **后端**: Python 项目管理器
- **前端**: Node PM2 项目
- **优点**: 支持热更新（开发模式）

**推荐使用方案一**，前端构建后使用静态文件即可。

---

## 🔄 更新代码流程

### 1. 本地修改代码

在本地 `/Users/huahua/Documents/gendan` 修改代码并测试。

### 2. 上传更新文件

通过宝塔面板「文件」管理上传修改的文件：
- `backend/app/` - 后端代码
- `frontend/src/` - 前端代码

### 3. 更新后端

1. 进入「Python项目管理器」
2. 找到 `hyperliquid-backend`
3. 点击「终端」
4. 运行：
   ```bash
   cd /www/wwwroot/gendan/backend
   source venv/bin/activate
   pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
   ```
5. 点击「重启」按钮

### 4. 更新前端

1. 进入「文件」管理
2. 进入 `/www/wwwroot/gendan/frontend`
3. 点击「终端」
4. 运行：
   ```bash
   npm run build
   ```
5. 前端会自动更新（静态文件）

---

## 🛠️ 服务管理

### Python 项目管理

- **启动/停止**: 点击项目右侧的「启动」/「停止」按钮
- **重启**: 点击「重启」按钮
- **查看日志**: 点击「日志」按钮
- **终端**: 点击「终端」按钮进入项目目录

### 网站管理

- **重启 Nginx**: 「网站」→ 点击网站「设置」→「重启」
- **查看日志**: 「网站」→ 点击网站「设置」→「日志」

---

## 📋 部署检查清单

- [ ] 项目文件已上传到 `/www/wwwroot/gendan`
- [ ] Python 项目管理器已安装
- [ ] Python 项目已创建并启动
- [ ] 前端已构建（`frontend/dist` 目录存在）
- [ ] 网站已创建（根目录指向 `frontend/dist`）
- [ ] 反向代理已配置（`/api` → `http://127.0.0.1:8000`）
- [ ] Nginx 配置了 `try_files`（支持前端路由）
- [ ] 防火墙端口已开放（80/443）
- [ ] SSL 证书已配置（可选）

---

## 🎉 完成！

部署完成后，访问您的域名即可使用系统。

**优势**：
- ✅ 图形化界面，操作简单
- ✅ 无需手动运行脚本
- ✅ 宝塔面板统一管理
- ✅ 日志查看方便
- ✅ 一键启动/停止/重启

---

## 💡 提示

1. **前端建议使用静态文件**：构建后直接由 Nginx 服务，不需要 Node PM2
2. **后端必须使用 Python 项目管理器**：FastAPI 需要 ASGI 协议
3. **端口冲突**：确保 8000 端口未被占用
4. **权限问题**：确保 `www` 用户有读写权限

