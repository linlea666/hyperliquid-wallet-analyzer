# 🚀 宝塔面板部署 - 一步一步操作（小白版）

## 📋 准备工作

- ✅ 服务器已安装宝塔面板
- ✅ 已登录宝塔面板
- ✅ GitHub 仓库：https://github.com/linlea666/hyperliquid-wallet-analyzer

---

## 🎯 第一步：克隆代码到服务器（推荐方式）

### 方式一：使用 Git 克隆（推荐）⭐

#### 1.1 打开终端

1. 登录宝塔面板
2. 点击左侧「**文件**」
3. 进入 `/www/wwwroot/` 目录
4. 点击右上角「**终端**」按钮（或按 `F12`）

#### 1.2 克隆代码

在终端中输入以下命令（一行一行复制执行）：

```bash
# 进入网站根目录
cd /www/wwwroot

# 克隆代码
git clone https://github.com/linlea666/hyperliquid-wallet-analyzer.git gendan

# 进入项目目录
cd gendan

# 查看文件（确认克隆成功）
ls -la
```

**如果网络问题，使用镜像**：
```bash
git clone https://ghproxy.com/https://github.com/linlea666/hyperliquid-wallet-analyzer.git gendan
```

**✅ 成功标志**：能看到 `backend` 和 `frontend` 文件夹

---

### 方式二：上传压缩包（备选）

如果 Git 克隆失败，可以：

1. **在本地打包**：
   ```bash
   cd /Users/huahua/Documents/gendan
   zip -r gendan.zip . -x "*.git*" "node_modules/*" "venv/*" "*.log"
   ```

2. **上传到服务器**：
   - 宝塔面板 → 「文件」→ `/www/wwwroot/`
   - 点击「上传」
   - 选择 `gendan.zip`
   - 上传完成后解压

---

## 🐍 第二步：配置 Python 后端

### 2.1 创建虚拟环境

在终端运行（确保在 `/www/wwwroot/gendan` 目录）：

```bash
cd /www/wwwroot/gendan

# 创建虚拟环境
python3 -m venv venv

# 激活虚拟环境
source venv/bin/activate

# 确认激活成功（命令行前面会显示 (venv)）
```

### 2.2 安装后端依赖

```bash
# 确保虚拟环境已激活（命令行前面有 (venv)）
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r backend/requirements.txt
```

**等待安装完成**（可能需要几分钟）

### 2.3 配置系统文件

```bash
# 复制配置文件
cp backend/data/config/system.json.example backend/data/config/system.json
```

**✅ 成功标志**：看到 `Successfully installed` 字样

---

## 📦 第三步：配置前端

### 3.1 安装前端依赖

在终端运行：

```bash
cd /www/wwwroot/gendan/frontend

# 使用国内镜像
npm config set registry https://registry.npmmirror.com

# 安装依赖
npm install
```

**等待安装完成**（可能需要几分钟）

### 3.2 构建前端

```bash
# 构建生产版本
npm run build
```

**✅ 成功标志**：看到 `dist` 文件夹，里面有 `index.html`

---

## ⚙️ 第四步：在宝塔面板配置 Python 项目

### 4.1 安装 Python 项目管理器

1. 点击左侧「**软件商店**」
2. 搜索「**Python项目管理器**」
3. 如果没有安装，点击「**安装**」
4. 等待安装完成

### 4.2 添加 Python 项目

1. 点击左侧「**Python项目**」（或「软件商店」→「Python项目管理器」）

2. 点击「**添加Python项目**」按钮

3. **填写项目信息**：

   | 字段 | 填写内容 | 说明 |
   |------|---------|------|
   | **项目名称** | `hyperliquid-backend` | 自定义名称 |
   | **Python版本** | 选择 `3.8` 或更高 | **推荐 `3.11.13`**（完全支持）或 `3.10.x`、`3.9.x` |
   | **启动方式** | `命令行启动` | ✅ 必须选择这个 |
   | **项目路径** | `/www/wwwroot/gendan/backend` | 后端目录 |
   | **启动命令** | `uvicorn app.main:app --host 0.0.0.0 --port 8000` | 复制粘贴 |
   | **启动用户** | `www` | 默认即可 |
   | **端口** | `8000` | 后端端口 |

4. **点击「更多设置」展开**：

   | 字段 | 填写内容 |
   |------|---------|
   | **执行命令** | `uvicorn app.main:app --host 0.0.0.0 --port 8000` |
   | **通讯协议** | `asgi` | ⚠️ 必须选择 ASGI |
   | **端口** | `8000` |
   | **项目初始化命令** | `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt` |

5. **点击「确定」创建项目**

### 4.3 安装依赖

1. 在项目列表中，找到 `hyperliquid-backend`
2. 点击右侧「**模块**」按钮
3. 点击「**从文件安装**」
4. 选择文件：`/www/wwwroot/gendan/backend/requirements.txt`
5. 点击「**安装**」
6. 等待安装完成

### 4.4 启动项目

1. 在项目列表中，找到 `hyperliquid-backend`
2. 点击右侧「**启动**」按钮
3. **✅ 成功标志**：状态变为「**运行中 ▶**」

---

## 🌐 第五步：配置网站（前端）

### 5.1 添加网站

1. 点击左侧「**网站**」
2. 点击「**添加站点**」按钮
3. **填写信息**：
   - **域名**：您的域名（如 `wallet.yourdomain.com`）或服务器 IP
   - **备注**：`HyperLiquid 钱包分析系统`
   - **根目录**：`/www/wwwroot/gendan/frontend/dist`
   - **PHP版本**：`纯静态`（不需要 PHP）
4. 点击「**提交**」

### 5.2 配置反向代理

1. 在网站列表中，找到刚创建的网站
2. 点击右侧「**设置**」按钮
3. 点击「**反向代理**」标签
4. 点击「**添加反向代理**」按钮
5. **填写配置**：
   - **代理名称**：`api`
   - **目标URL**：`http://127.0.0.1:8000`
   - **发送域名**：`$host`
   - **缓存**：关闭
6. 点击「**提交**」

### 5.3 配置前端路由（重要）

1. 在网站设置中，点击「**配置文件**」标签
2. 找到 `location /` 部分，修改为：

```nginx
location / {
    root /www/wwwroot/gendan/frontend/dist;
    try_files $uri $uri/ /index.html;
    index index.html;
}

# API 代理
location /api {
    proxy_pass http://127.0.0.1:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

3. 点击「**保存**」按钮
4. 点击「**重载配置**」或「**重启**」

---

## 🔧 第六步：配置防火墙

1. 点击左侧「**安全**」
2. 确保以下端口已开放：
   - **8000**（后端 API）
   - **80**（HTTP）
   - **443**（HTTPS，如果使用 SSL）

如果没有开放，点击「**添加端口规则**」添加。

---

## ✅ 第七步：测试访问

### 7.1 测试后端 API

在浏览器访问：
```
http://您的域名或IP:8000/docs
```

**✅ 成功标志**：能看到 FastAPI 的 API 文档页面（Swagger UI）

### 7.2 测试前端

在浏览器访问：
```
http://您的域名或IP
```

**✅ 成功标志**：能看到前端界面

---

## 🔄 第八步：配置自动更新（可选）

### 8.1 使用更新脚本

项目已包含 `update.sh` 脚本，在终端运行：

```bash
cd /www/wwwroot/gendan
chmod +x update.sh
./update.sh
```

### 8.2 手动更新流程

以后更新代码时：

1. **拉取最新代码**：
   ```bash
   cd /www/wwwroot/gendan
   git pull origin main
   ```

2. **更新前端**（如果有前端修改）：
   ```bash
   cd frontend
   npm run build
   ```

3. **重启后端**：
   - 宝塔面板 → Python项目 → 找到 `hyperliquid-backend` → 点击「重启」

---

## 📋 完整配置清单

检查以下项目是否都已完成：

- [ ] 代码已克隆到 `/www/wwwroot/gendan`
- [ ] Python 虚拟环境已创建（`venv` 文件夹存在）
- [ ] 后端依赖已安装（`pip list` 能看到依赖）
- [ ] 前端依赖已安装（`frontend/node_modules` 存在）
- [ ] 前端已构建（`frontend/dist` 文件夹存在）
- [ ] Python 项目已在宝塔面板创建
- [ ] Python 项目状态为「运行中 ▶」
- [ ] 网站已创建（根目录指向 `frontend/dist`）
- [ ] 反向代理已配置（`/api` → `http://127.0.0.1:8000`）
- [ ] Nginx 配置了 `try_files`（支持前端路由）
- [ ] 防火墙端口已开放（80/443/8000）
- [ ] 后端 API 可以访问（`http://域名:8000/docs`）
- [ ] 前端页面可以访问（`http://域名`）

---

## 🐛 常见问题解决

### Q1: Python 项目启动失败？

**检查步骤**：
1. 查看日志：Python项目 → 点击「日志」按钮
2. 检查虚拟环境：确认 `venv` 文件夹存在
3. 检查依赖：在终端运行 `pip list`
4. 检查端口：确认 8000 端口未被占用

**解决方法**：
```bash
cd /www/wwwroot/gendan
source venv/bin/activate
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r backend/requirements.txt
```

### Q2: 前端页面空白？

**检查步骤**：
1. 确认前端已构建：`ls frontend/dist`
2. 检查 Nginx 配置的根目录是否正确
3. 打开浏览器开发者工具（F12）查看控制台错误

**解决方法**：
```bash
cd /www/wwwroot/gendan/frontend
npm run build
```

### Q3: API 请求失败（404 或 500）？

**检查步骤**：
1. 检查后端是否运行：访问 `http://域名:8000/docs`
2. 检查 Nginx 反向代理配置
3. 检查防火墙端口是否开放

**解决方法**：
- 确认反向代理配置正确
- 确认后端服务正在运行
- 检查 Nginx 错误日志

### Q4: Git 克隆失败？

**解决方法**：
1. 使用镜像：`git clone https://ghproxy.com/https://github.com/linlea666/hyperliquid-wallet-analyzer.git gendan`
2. 或上传压缩包方式部署

### Q5: npm install 很慢或失败？

**解决方法**：
```bash
npm config set registry https://registry.npmmirror.com
npm install
```

### Q6: 如何查看日志？

- **后端日志**：Python项目 → 点击「日志」按钮
- **Nginx 日志**：网站 → 设置 → 「日志」
- **系统日志**：宝塔面板 → 「日志」

---

## 🎉 完成！

现在您的项目应该已经部署成功了！

访问您的域名或 IP，应该能看到前端界面。

---

## 📞 需要帮助？

如果遇到问题：
1. 查看对应的日志文件
2. 检查配置是否正确
3. 截图错误信息，我可以帮您解决

---

## 💡 提示

1. **前端使用静态文件**：构建后直接由 Nginx 服务，不需要 Node PM2
2. **后端必须使用 ASGI**：FastAPI 需要 ASGI 协议，不是 WSGI
3. **端口冲突**：确保 8000 端口未被占用
4. **权限问题**：确保 `www` 用户有读写权限

---

**开始部署吧！按照步骤一步一步来，有问题随时问我！** 🚀

